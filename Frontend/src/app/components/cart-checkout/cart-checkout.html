<div class="cart-checkout-container">
  <div class="row">
    <!-- Cart Items Section -->
    <div class="col-md-8">
      <div class="cart-section">
        <h2>Shopping Cart</h2>

        <!-- Error Message -->
        <div class="alert alert-danger" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <!-- Cart Items -->
        <div class="cart-items" *ngIf="cartItems.length > 0">
          <div class="cart-item" *ngFor="let item of cartItems">
            <div class="item-image">
              <img [src]="item.image" [alt]="item.name" *ngIf="item.image">
              <div class="placeholder-image" *ngIf="!item.image">
                <i class="fas fa-image"></i>
              </div>
            </div>

            <div class="item-details">
              <h5 class="item-name">{{ item.name }}</h5>
              <p class="item-creator">by {{ item.creator }}</p>
              <p class="item-price">{{ item.price | currency:item.currency }}</p>
            </div>

            <div class="item-total">
              <strong>{{ item.price | currency:item.currency }}</strong>
            </div>

            <div class="item-actions">
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="removeItem(item.productId)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Empty Cart -->
        <div class="empty-cart" *ngIf="cartItems.length === 0">
          <div class="empty-cart-content">
            <div class="empty-cart-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added any products to your cart yet.</p>
            <p>Start exploring our digital products and add them to your cart!</p>
            <button class="btn btn-primary btn-lg" (click)="continueShopping()">
              <i class="fas fa-shopping-bag me-2"></i>
              Start Shopping
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout Section -->
    <div class="col-md-4" *ngIf="cartItems.length > 0">
      <div class="checkout-section">
        <h3>Checkout</h3>

        <!-- Account Balance Display -->
        <div class="balance-section">
          <div class="balance-card">
            <h4>Account Balance</h4>
            <div class="balance-amount" *ngIf="!balanceLoading">
              {{ currentBalance | currency:'USD' }}
            </div>
            <div class="balance-loading" *ngIf="balanceLoading">
              <i class="fas fa-spinner fa-spin"></i> Loading...
            </div>
            <div class="balance-status" [class.sufficient]="hasSufficientBalance" [class.insufficient]="!hasSufficientBalance">
              <i class="fas" [class.fa-check-circle]="hasSufficientBalance" [class.fa-exclamation-triangle]="!hasSufficientBalance"></i>
              <span *ngIf="hasSufficientBalance">Sufficient balance for purchase</span>
              <span *ngIf="!hasSufficientBalance && totalInUSD > 0">
                Insufficient balance for purchase (Need {{ totalInUSD | currency:'USD' }} USD)
              </span>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h4>Order Summary</h4>
          <div class="summary-item" *ngFor="let item of cartItems">
            <span>{{ item.name }}</span>
            <span>{{ item.price | currency:item.currency }}</span>
          </div>
          <div class="summary-total">
            <strong>Total: {{ total | currency:itemCurrency }}</strong>
            <div class="converted-total" *ngIf="itemCurrency !== 'USD'">
              <small>({{ totalInUSD | currency:'USD' }} USD)</small>
            </div>
          </div>
        </div>

        <!-- Checkout Form -->
        <form [formGroup]="checkoutForm" (ngSubmit)="processCheckout()">
          <div class="form-group mb-3">
            <label for="email" class="form-label">Email Address</label>
            <input
              type="email"
              id="email"
              class="form-control"
              formControlName="email"
              readonly
              [value]="checkoutForm.get('email')?.value"
              placeholder="Your email address">
            <small class="form-text text-muted">Confirmation email will be sent to this address</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" formControlName="firstName" class="form-control">
            </div>

            <div class="form-group">
              <label>Last Name</label>
              <input type="text" formControlName="lastName" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label>Billing Address</label>
            <textarea formControlName="billingAddress" class="form-control" rows="3"></textarea>
          </div>

          <!-- Payment Method Selection -->
          <div class="payment-method-section">
            <h5>Payment Method</h5>
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              Payment will be processed using your account balance.
            </div>
          </div>

          <!-- Checkout Button -->
          <button
            type="submit"
            class="btn btn-primary btn-lg w-100"
            [disabled]="isLoading || !hasSufficientBalance || checkoutForm.invalid">
            <span *ngIf="!isLoading">
              <i class="fas fa-credit-card me-2"></i>
              Complete Purchase
            </span>
            <span *ngIf="isLoading">
              <i class="fas fa-spinner fa-spin me-2"></i>
              Processing...
            </span>
          </button>
        </form>

        <!-- Continue Shopping -->
        <div class="continue-shopping mt-3">
          <button class="btn btn-outline-secondary w-100" (click)="goToDiscover()">
            <i class="fas fa-arrow-left me-2"></i>
            Continue Shopping
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
