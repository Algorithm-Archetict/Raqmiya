<div class="hierarchical-category-nav">
  <div class="category-filters">
    <div class="filter-buttons">
      <!-- All Categories Button -->
      <button 
        class="filter-btn" 
        [class.active]="selectedCategoryId === 'all'"
        (click)="onCategoryClick('all')"
      >
        <i class="fas fa-th-large"></i>
        All
      </button>

      <!-- Visible Category Buttons -->
      <div 
        *ngFor="let category of visibleCategories; trackBy: trackByCategory"
        class="category-wrapper"
      >
        <button 
          class="filter-btn category-btn" 
          [class.active]="selectedCategoryId === category.id"
          (click)="onCategoryClick(category.id)"
        >
          <i [class]="getCategoryIcon(category.name)"></i>
          {{ category.name }}
          <!-- Debug indicator for subcategories -->
          <span *ngIf="category.subcategories && category.subcategories.length > 0" 
                style="font-size: 0.7rem; margin-left: 5px; color: #10b981;">
            ({{ category.subcategories.length }})
          </span>
        </button>

        <!-- Subcategory Dropdown - Always in DOM, controlled by CSS -->
        <div 
          class="subcategory-dropdown"
          *ngIf="category.subcategories && category.subcategories.length > 0"
        >
          <div class="dropdown-content">
            <!-- All in this category option -->
            <button 
              class="subcategory-item all-in-category"
              (click)="onSubcategoryClick($event, category.id, true)"
            >
              <i class="fas fa-layer-group"></i>
              <span class="subcategory-text">
                <strong>All {{ category.name }}</strong>
                <small>Including all subcategories</small>
              </span>
            </button>

            <div class="subcategory-divider"></div>

            <!-- Individual subcategories -->
            <div class="subcategories-list">
              <div 
                *ngFor="let subcategory of category.subcategories"
                class="subcategory-group"
              >
                <button 
                  class="subcategory-item"
                  [class.active]="selectedCategoryId === subcategory.id"
                  (click)="onSubcategoryClick($event, subcategory.id, false)"
                >
                  <i class="fas fa-folder"></i>
                  <span class="subcategory-text">{{ subcategory.name }}</span>
                </button>

                <!-- Sub-subcategories -->
                <div 
                  *ngIf="subcategory.subcategories && subcategory.subcategories.length > 0"
                  class="sub-subcategories"
                >
                  <button 
                    *ngFor="let subSubcategory of subcategory.subcategories"
                    class="subcategory-item sub-subcategory"
                    [class.active]="selectedCategoryId === subSubcategory.id"
                    (click)="onSubcategoryClick($event, subSubcategory.id, false)"
                  >
                    <i class="fas fa-file"></i>
                    <span class="subcategory-text">{{ subSubcategory.name }}</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- All categories are now displayed without "More" button -->
    </div>
  </div>
</div>