<div class="add-product-container">
  <!-- Left Sidebar -->
  <app-dashboard-sidebar></app-dashboard-sidebar>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Header Section -->
    <div class="product-header">
      <div class="header-left">
        <h1 class="header-title">{{ productForm.get('name')?.value || 'Edit Product' }}</h1>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
          <a class="nav-tab active" routerLink="/products/{{ productId }}/edit">
            <i class="fas fa-edit"></i>
            Product
          </a>
          <a class="nav-tab" routerLink="/products/{{ productId }}/edit/content">
            <i class="fas fa-file-alt"></i>
            Content
          </a>
        </div>
      </div>
      
      <div class="header-right">
        <button 
          class="btn btn-danger" 
          [disabled]="isDeleting"
          (click)="deleteProduct()"
        >
          <i class="fas fa-spinner fa-spin me-2" *ngIf="isDeleting"></i>
          {{ isDeleting ? 'Deleting...' : 'Delete Product' }}
        </button>
        <button class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          [disabled]="!isFormValid || isSubmitting"
          (click)="saveChanges()"
        >
          <i class="fas fa-spinner fa-spin me-2" *ngIf="isSubmitting"></i>
          {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </div>

    <!-- Error and Success Messages -->
    <div class="messages-container" *ngIf="errorMessage || successMessage">
      <div class="alert alert-danger" *ngIf="errorMessage">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ errorMessage }}
      </div>
      <div class="alert alert-success" *ngIf="successMessage">
        <i class="fas fa-check-circle me-2"></i>
        {{ successMessage }}
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isSubmitting && !product">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading product...</p>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area" *ngIf="product">
      <!-- Customize Product -->
      <div class="customize-step">
        <div class="customize-layout">
          <!-- Left Section - Form -->
          <div class="form-section" [formGroup]="productForm">
            <div class="form-group">
              <label for="productNameEdit" class="form-label">Name</label>
              <input 
                type="text" 
                id="productNameEdit"
                class="form-input"
                placeholder="Name of your product"
                [formControlName]="'name'"
                (input)="onNameChange()"
              >
            </div>
            
            <div class="form-group">
              <label for="productDescription" class="form-label">Description</label>
              <textarea 
                id="productDescription"
                class="form-textarea"
                placeholder="Describe your product..."
                [formControlName]="'description'"
                rows="6"
              ></textarea>
            </div>
            
            <div class="form-group">
              <label for="productPrice" class="form-label">Price</label>
              <div class="price-input-group">
                <input 
                  type="number" 
                  id="productPrice"
                  class="form-input"
                  placeholder="Price your product"
                  [formControlName]="'price'"
                >
                <select class="currency-select" [(ngModel)]="currency" [ngModelOptions]="{standalone: true}">
                  <option value="EGP">EGP</option>
                  <option value="USD">USD</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="productUrl" class="form-label">URL</label>
              <input 
                type="text" 
                id="productUrl"
                class="form-input"
                [formControlName]="'url'"
                readonly
              >
            </div>
            
            <!-- Product Type Selection -->
            <div class="form-group">
              <label class="form-label">Product Type</label>
              <div class="product-types">
                <div 
                  class="product-type-card" 
                  *ngFor="let type of productTypes"
                  [class.selected]="type.selected"
                  (click)="selectProductType(type.id)"
                >
                  <div class="type-icon">
                    <i [class]="type.icon"></i>
                  </div>
                  <div class="type-content">
                    <h3 class="type-name">{{ type.name }}</h3>
                    <p class="type-description">{{ type.description }}</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Cover Images Section -->
            <div class="section-divider"></div>
            <div class="form-group">
              <label class="form-label">Cover Images</label>
              <button 
                class="upload-btn"
                (click)="showCoverOptions = !showCoverOptions"
              >
                <i class="fas fa-upload"></i>
                Upload a cover image
              </button>
              
              <div class="upload-options" *ngIf="showCoverOptions">
                <div class="upload-option">
                  <input 
                    type="file" 
                    id="coverFile" 
                    accept="image/*"
                    (change)="uploadCoverImage($event)"
                    style="display: none;"
                  >
                  <label for="coverFile" class="upload-option-btn">
                    <i class="fas fa-folder-open"></i>
                    Computer files
                  </label>
                </div>
                <div class="upload-option">
                  <div class="link-input-group">
                    <input 
                      type="url" 
                      class="form-input"
                      placeholder="Enter image URL"
                      [(ngModel)]="coverImageLink"
                      [ngModelOptions]="{standalone: true}"
                    >
                    <button 
                      class="btn btn-secondary"
                      (click)="uploadCoverFromLink()"
                    >
                      <i class="fas fa-upload"></i>
                    </button>
                  </div>
                </div>
              </div>
              
              <p class="upload-hint">
                Images should be horizontal, at least 1280x720px, and 72 DPI (dots per inch).
              </p>
              
              <!-- Cover Images Preview -->
              <div class="cover-images-preview" *ngIf="coverImages.length > 0">
                <div class="cover-image-item" *ngFor="let image of coverImages; let i = index">
                  <img [src]="image" [alt]="'Cover image ' + (i + 1)">
                  <button class="remove-btn" (click)="removeCoverImage(i)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Thumbnail Section -->
            <div class="section-divider"></div>
            <div class="form-group">
              <label class="form-label">Thumbnail</label>
              <input 
                type="file" 
                id="thumbnailFile" 
                accept="image/*"
                (change)="uploadThumbnail($event)"
                style="display: none;"
              >
              <label for="thumbnailFile" class="upload-btn">
                <i class="fas fa-upload"></i>
                Upload thumbnail
              </label>
              
              <p class="upload-hint">
                This image appears in the Raqmiya Library, Discover and Profile pages. Your image should be square, at least 600x600px, and JPG, PNG or GIF format.
              </p>
              
              <!-- Thumbnail Preview -->
              <div class="thumbnail-preview" *ngIf="thumbnailImage">
                <img [src]="thumbnailImage" alt="Thumbnail">
              </div>
            </div>
            
            <!-- Product Features Section -->
            <div class="section-divider"></div>
            <div class="form-group">
              <label class="form-label">Product Features</label>
              <div class="features-card">
                <p class="features-hint">
                  List the key features and benefits of your product
                </p>
                <div class="features-input-group">
                  <input 
                    type="text" 
                    class="form-input"
                    placeholder="Add a feature (e.g., 10 fully rigged 3D characters)"
                    [(ngModel)]="newFeature"
                    [ngModelOptions]="{standalone: true}"
                  >
                  <button 
                    class="btn btn-primary"
                    (click)="addFeature()"
                    [disabled]="!newFeature.trim()"
                  >
                    Add Feature
                  </button>
                </div>
                
                <!-- Existing Features -->
                <div class="existing-features" *ngIf="productFeatures.length > 0">
                  <div class="feature-item" *ngFor="let feature of productFeatures; let i = index">
                    <i class="fas fa-check-circle"></i>
                    <span class="feature-text">{{ feature }}</span>
                    <button class="remove-feature-btn" (click)="removeFeature(i)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Product Specifications Section -->
            <div class="section-divider"></div>
            <div class="form-group">
              <label class="form-label">Product Specifications</label>
              <div class="specs-grid">
                <div class="spec-item">
                  <label for="compatibility" class="spec-label">Compatibility</label>
                  <input 
                    type="text" 
                    id="compatibility"
                    class="form-input"
                    placeholder="e.g., Unity, Unreal Engine, Blender"
                    [formControlName]="'compatibility'"
                  >
                </div>
                
                <div class="spec-item">
                  <label for="license" class="spec-label">License Type</label>
                  <select id="license" class="form-input" [formControlName]="'license'">
                    <option value="">Select License</option>
                    <option value="Standard">Standard License</option>
                    <option value="Commercial">Commercial License</option>
                    <option value="Extended">Extended License</option>
                    <option value="Custom">Custom License</option>
                  </select>
                </div>
                
                <div class="spec-item">
                  <label for="updates" class="spec-label">Update Policy</label>
                  <select id="updates" class="form-input" [formControlName]="'updates'">
                    <option value="">Select Update Policy</option>
                    <option value="Lifetime Updates">Lifetime Updates</option>
                    <option value="1 Year Updates">1 Year Updates</option>
                    <option value="6 Months Updates">6 Months Updates</option>
                    <option value="No Updates">No Updates</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- File Upload Section -->
            <div class="section-divider"></div>
            <div class="form-group">
              <label class="form-label">Product Files</label>
              <div class="file-upload-area">
                <input 
                  type="file" 
                  id="productFiles" 
                  multiple
                  accept=".pdf,.zip,.txt,.jpg,.jpeg,.png,.gif,.mp4,.mp3"
                  (change)="onFileSelected($event)"
                  style="display: none;"
                >
                <label for="productFiles" class="upload-btn">
                  <i class="fas fa-upload"></i>
                  Upload product files
                </label>
                <p class="upload-hint">
                  Supported formats: PDF, ZIP, TXT, JPG, PNG, GIF, MP4, MP3. Maximum file size: 250MB per file.
                </p>
              </div>
              
              <!-- File Preview -->
              <div class="file-preview" *ngIf="productFiles.length > 0">
                <div class="file-item" *ngFor="let file of productFiles; let i = index">
                  <div class="file-info">
                    <i class="fas fa-file"></i>
                    <span class="file-name">{{ file.name }}</span>
                    <span class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</span>
                  </div>
                  <button class="remove-btn" (click)="removeFile(i)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              
              <!-- Upload Progress -->
              <div class="upload-progress" *ngIf="isUploading">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="uploadProgress"></div>
                </div>
                <span class="progress-text">Uploading files... {{ uploadProgress }}%</span>
              </div>
              
              <!-- Uploaded Files -->
              <div class="uploaded-files" *ngIf="uploadedFiles.length > 0">
                <h4 class="uploaded-title">Uploaded Files</h4>
                <div class="uploaded-file-item" *ngFor="let file of uploadedFiles">
                  <i class="fas fa-check-circle"></i>
                  <span class="file-name">{{ file.name }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right Section - Preview -->
          <div class="preview-section">
            <div class="preview-card">
              <div class="preview-header">
                <h3>Product Preview</h3>
                <p>This is how your product will appear to customers</p>
              </div>
              
              <div class="preview-content">
                <!-- Product Image -->
                <div class="preview-image" *ngIf="coverImages.length > 0">
                  <img [src]="coverImages[0]" alt="Product preview">
                </div>
                <div class="preview-image-placeholder" *ngIf="coverImages.length === 0">
                  <i class="fas fa-image"></i>
                  <p>Upload a cover image to see preview</p>
                </div>
                
                <!-- Product Info -->
                <div class="preview-info">
                  <h2 class="preview-title">{{ productForm.get('name')?.value || 'Product Name' }}</h2>
                  <p class="preview-description">{{ productForm.get('description')?.value || 'Product description will appear here...' }}</p>
                  
                  <!-- Product Features -->
                  <div class="preview-features" *ngIf="productFeatures.length > 0">
                    <h4>Features:</h4>
                    <ul class="features-list">
                      <li *ngFor="let feature of productFeatures">
                        <i class="fas fa-check"></i> {{ feature }}
                      </li>
                    </ul>
                  </div>
                  
                  <!-- Price -->
                  <div class="preview-price">
                    <span class="price-amount">{{ productForm.get('price')?.value || '0' }}</span>
                    <span class="price-currency">{{ currency }}</span>
                  </div>
                  <button class="preview-buy-btn">Buy now</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


